<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{{ team.name }} — Hockey Stats</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-white text-gray-900">
  <header class="bg-[#F9E76D] text-black">
    <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
      <h1 class="text-lg font-bold">Hockey Stats</h1>
      <nav>
        <ul class="flex space-x-6 text-sm font-medium">
          <li><a href="/" class="hover:underline">Home</a></li>
          <li><a href="/teams" class="hover:underline">Teams</a></li>
          <li><a href="/players" class="hover:underline">Players</a></li>
          <li><a href="/goalies" class="hover:underline">Goalies</a></li>
          <li><a href="/insights" class="hover:underline">Insights</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <div class="h-16 bg-white"></div>

  <main class="max-w-6xl mx-auto px-4 mt-4">

  
  <div class="mb-4">
    <h2 class="text-2xl font-bold mb-1">{{ team.name }} ({{ team.abbrev }}) — NHL 2021/2022 Team Overview</h2>
         <div class="flex items-center text-gray-700 text-sm space-x-4">
      <span><strong>Division:</strong> {{ team.division|capitalize }}</span>
      <span><strong>Conference:</strong> {{ team.conference|capitalize }}</span>
    </div>
  </div>
<div class="h-4 bg-white"></div>

  
  <div class="grid grid-cols-1 sm:grid-cols-3 gap-8 text-sm">

    <!-- Левая колонка -->
    <section class="space-y-3">
 <h2 class="text-base font-semibold underline">
  Außenseiter-Siege 
  <span data-metric="upset_win" class="metric-help inline-block relative ml-1 text-gray-500 cursor-pointer">❓</span>
</h2>

  <p>Siege als Außenseiter: <strong>{{ num_upsets }}</strong></p>
  <p>Gesamtanzahl Spiele: <strong>{{ total_games }}</strong></p>
  <p>Upset-Anteil: <strong>{{ upset_share }}%</strong></p>

  <h3 class="font-semibold underline">Nach Saisonphase</h3>
  <table class="table-auto border-collapse border border-gray-300 w-full text-xs">
    <thead>
      <tr>
        <th class="border p-1 text-center">Phase</th>
        <th class="border p-1 text-center">Spiele</th>
        <th class="border p-1 text-center">Upsets</th>
        <th class="border p-1 text-center">%</th>
      </tr>
    </thead>
    <tbody>
      {% for stage in stage_stats.stages %}
      <tr>
        <td class="border p-1">{{ stage|capitalize }}</td>
        <td class="border p-1 text-center">{{ stage_stats.totals[stage] }}</td>
        <td class="border p-1 text-center">{{ stage_stats.upsets.get(stage, 0) }}</td>
        <td class="border p-1 text-center">
          {{ ((stage_stats.upsets.get(stage, 0) / stage_stats.totals[stage]) * 100) | round(2) if stage_stats.totals[stage] > 0 else 0 }}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <p><strong>Ø Quote bei Upsets:</strong> {{ avg_upset_quote }} <span data-metric="avg_upset_quote" class="metric-help">❓</span> </p>
  <p><strong>Siege bei Quote &gt; 2.5:</strong> {{ threshold_upsets }}/{{ threshold_total }} ({{ threshold_share }}%) <span data-metric="threshold_upsets" class="metric-help">❓</span> </p>
  <p><strong>Heimniederlagen als Favorit:</strong> {{ home_fav_losses }}/{{ total_home_games }} ({{ home_loss_share }}%) <span data-metric="home_fav_losses" class="metric-help">❓</span> </p>

  <div class="h-4 bg-white"></div>

  <h3 class="font-semibold italic mt-2 underline">Korrelationsanalyse</h3>
<ul class="list-disc list-inside space-y-1">
  <li>Ø Faceoff-Quote bei Siegen: <strong>{{ correlation_metrics.faceoff_win_in_wins }}%</strong>
    <span data-metric="faceoff_win_in_wins" class="metric-help">❓</span>
  </li>
  <li>Ø Faceoff-Quote bei Niederlagen: <strong>{{ correlation_metrics.faceoff_win_in_losses }}%</strong>
    <span data-metric="faceoff_win_in_losses" class="metric-help">❓</span>
  </li>
  <li>Korrelation Schüsse ↔ Tore: <strong>{{ correlation_metrics.shot_goal_corr }}</strong>
    <span data-metric="shot_goal_corr" class="metric-help">❓</span>
  </li>
  <li>Ø Strafminuten bei Siegen: <strong>{{ correlation_metrics.pim_in_wins }}</strong>
    <span data-metric="pim_in_wins" class="metric-help">❓</span>
  </li>
  <li>Ø Strafminuten bei Niederlagen: <strong>{{ correlation_metrics.pim_in_losses }}</strong>
    <span data-metric="pim_in_losses" class="metric-help">❓</span>
  </li>
  <li>Siegquote bei Powerplay-Tor: <strong>{{ correlation_metrics.pp_conversion_win_rate }}%</strong>
    <span data-metric="pp_conversion_win_rate" class="metric-help">❓</span>
  </li>
</ul>

</section>

    <section class="space-y-3">
  <h2 class="text-base font-semibold underline">
    Unentschieden und Zusatzresultate
    <span data-metric="draw_games" class="metric-help">❓</span>
  </h2>
  <p>Unentschieden in regulärer Spielzeit: <strong>{{ games_with_draw }}</strong> von <strong>{{ total_games_draw }}</strong> ({{ draw_share }}%)</p>

  <p><strong>Außenseiter-Siege in OT/SO:</strong> {{ wins_in_overtime }}/{{ total_as_underdog }} ({{ overtime_upset_share }}%)
    <span data-metric="overtime_upset_share" class="metric-help">❓</span>
  </p>

  <p><strong>Favoriten-Niederlagen in OT/SO:</strong> {{ losses_in_overtime }}/{{ total_as_favorite }} ({{ favorite_overtime_loss_share }}%)
    <span data-metric="favorite_overtime_loss_share" class="metric-help">❓</span>
  </p>

  <h3 class="font-semibold underline">Ergebnisse in OT und Penaltyschießen</h3>
  <table class="table-auto border-collapse border border-gray-300 w-full text-xs">
    <thead>
      <tr>
        <th class="border p-1">Typ</th>
        <th class="border p-1 text-center">Siege</th>
        <th class="border p-1 text-center">Niederlagen</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td class="border p-1">Overtime</td>
        <td class="border p-1 text-center">{{ ot_so_results.wins_ot }}</td>
        <td class="border p-1 text-center">{{ ot_so_results.losses_ot }}</td>
      </tr>
      <tr>
        <td class="border p-1">Shootout</td>
        <td class="border p-1 text-center">{{ ot_so_results.wins_so }}</td>
        <td class="border p-1 text-center">{{ ot_so_results.losses_so }}</td>
      </tr>
    </tbody>
  </table>

  <h2 class="text-base font-semibold underline">Buchmacherfehler und Muster</h2>
  <p><strong>Ø erwartete Gewinnwahrscheinlichkeit:</strong> {{ bookmaker_analysis.expected_win_rate }}%
    <span data-metric="avg_expected_win" class="metric-help">❓</span>
  </p>

  <p><strong>Reale Siegquote:</strong> {{ bookmaker_analysis.real_win_rate }}% ({{ total_games }} Spiele)
    <span data-metric="real_win_rate" class="metric-help">❓</span>
  </p>

  <p><strong>Upset-Serien:</strong> max. in Folge — {{ max_upset_streak }}</p>
  <p><strong>Favoriten-Niederlagen-Serien:</strong> max. in Folge — {{ max_fav_loss_streak }}</p>

  <div class="h-4 bg-white"></div>

  <h3 class="font-semibold italic mt-2 underline">Effizienzkennzahlen</h3>
  <ul class="list-disc list-inside space-y-1">
    <li>Shot Conversion Rate: <strong>{{ advanced_ratios.shot_conversion }}%</strong>
      <span data-metric="shot_conversion" class="metric-help">❓</span>
    </li>
    <li>Siegquote bei Faceoff Win% &gt; 50%: <strong>{{ advanced_ratios.faceoff_win_impact }}%</strong>
      <span data-metric="faceoff_win_impact" class="metric-help">❓</span>
    </li>
    <li>Hit-to-Goal Ratio: <strong>{{ advanced_ratios.hit_to_goal }}</strong>
      <span data-metric="hit_to_goal" class="metric-help">❓</span>
    </li>
    <li>Block-to-Shot Ratio: <strong>{{ advanced_ratios.block_to_shot }}%</strong>
      <span data-metric="block_to_shot" class="metric-help">❓</span>
    </li>
  </ul>
</section>

    <!-- Правая колонка -->
    <aside class="space-y-3">
  <h2 class="text-base font-semibold underline">Gesamtstatistik</h2>
  <ul class="list-disc list-inside">
    <li>Spiele: <strong>{{ game_summary.total_games }}</strong></li>
    <li>Siege: <strong>{{ game_summary.wins }}</strong></li>
    <li>Niederlagen: <strong>{{ game_summary.losses }}</strong></li>
    <li>Unentschieden: <strong>{{ game_summary.draws }}</strong>
      <span data-metric="draw_games" class="metric-help">❓</span>
    </li>
  </ul>

  <h3 class="font-semibold underline">Tore</h3>
  <ul class="list-disc list-inside">
    <li>Erzielt: <strong>{{ goal_stats.goals_for }}</strong></li>
    <li>Kassiert: <strong>{{ goal_stats.goals_against }}</strong></li>
    <li>Tordifferenz: <strong>{{ goal_stats.goal_diff }}</strong>
      <span data-metric="goal_diff" class="metric-help">❓</span>
    </li>
    <li>Ø Tore pro Spiel (erzielt): <strong>{{ goal_stats.avg_goals_for }}</strong></li>
    <li>Ø Tore pro Spiel (kassiert): <strong>{{ goal_stats.avg_goals_against }}</strong></li>
  </ul>

  <h3 class="font-semibold underline">Torschüsse</h3>
  <ul class="list-disc list-inside">
    <li>Für: <strong>{{ sog_stats.sog_for }}</strong> (Ø {{ sog_stats.avg_sog_for }})
      <span data-metric="sog_for" class="metric-help">❓</span>
    </li>
    <li>Gegen: <strong>{{ sog_stats.sog_against }}</strong> (Ø {{ sog_stats.avg_sog_against }})</li>
  </ul>

  <h3 class="font-semibold underline">Bullys</h3>
  <p>Win%: <strong>{{ faceoff_stats.avg_faceoff_win_pct }}%</strong>
    <span data-metric="avg_faceoff_win_pct" class="metric-help">❓</span>
  </p>

  <h3 class="font-semibold underline">Special Teams</h3>
  <p>PP: <strong>{{ special_teams_stats.total_pp_goals }}/{{ special_teams_stats.total_pp_attempts }}</strong> ({{ special_teams_stats.powerplay_pct }}%)
    <span data-metric="powerplay_pct" class="metric-help">❓</span>
  </p>
  <p>PIM: <strong>{{ special_teams_stats.total_pim }}</strong> (Ø {{ special_teams_stats.avg_pim_per_game }} Min/Spiel)
    <span data-metric="avg_pim_per_game" class="metric-help">❓</span>
  </p>

  <h3 class="font-semibold underline">Checks & Blocks</h3>
  <p>Checks: <strong>{{ hits_blocks_stats.total_hits }}</strong> (Ø {{ hits_blocks_stats.avg_hits }})
    <span data-metric="avg_hits" class="metric-help">❓</span>
  </p>
  <p>Blocks: <strong>{{ hits_blocks_stats.total_blocks }}</strong> (Ø {{ hits_blocks_stats.avg_blocks }})</p>

  <h3 class="font-semibold underline">Serien</h3>
  <p>Siegesserie: <strong>{{ streaks.max_win_streak }}</strong></p>
  <p>Niederlagenserie: <strong>{{ streaks.max_loss_streak }}</strong></p>

  <p><strong>Heimspiele:</strong> W {{ home_away_stats.home_wins }} / L {{ home_away_stats.home_losses }}</p>
  <p><strong>Auswärtsspiele:</strong> W {{ home_away_stats.away_wins }} / L {{ home_away_stats.away_losses }}</p>
</aside>

</main>
<script src="https://unpkg.com/alpinejs" defer></script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    fetch('/static/metrics_help.json')
      .then(response => response.json())
      .then(data => {
        document.querySelectorAll('[data-metric]').forEach(el => {
          const key = el.getAttribute('data-metric');
          const text = data[key]?.de;
          if (text) {
            // Оборачиваем ❓ в Alpine Tooltip
            const wrapper = document.createElement('span');
            wrapper.setAttribute('x-data', '{ open: false }');
            wrapper.classList.add('relative', 'inline-block');

            wrapper.innerHTML = `
              <span @mouseover="open = true" @mouseleave="open = false" class="text-gray-500 ml-1 cursor-pointer">❓</span>
              <span x-show="open" class="absolute z-10 left-5 top-5 text-xs bg-white p-2 border rounded shadow w-64" style="display:none;" x-transition>
                ${text}
              </span>
            `;
            el.replaceWith(wrapper);
          }
        });
      });
  });
</script>
</body>
</html>